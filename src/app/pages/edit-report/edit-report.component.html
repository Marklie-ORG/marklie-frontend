<div class="dashboard">

    <div class="header">
        <div class="marketing-company-logo d-flex justify-center">
            <img 
            src="https://cdn.prod.website-files.com/667eae9f40316067da6a840e/66a2570e3547bce803ab61be_Transparant_svg%20(1)%201.png"
            alt="Marketing Company Logo"
            >
        </div>

        <div class="title-section">
            <h1>Weekly Report</h1>
            <div class="report-date-range">24.02.25 â€” 02.03.25</div>
            <div class="color-picker-wrapper">
                <div class="color-picker-item">
                    <label>Header</label>
                    <input 
                        type="color" 
                        [(ngModel)]="headerBackgroundColor" 
                        (ngModelChange)="onHeaderColorChange($event)"
                        class="header-color-picker"
                        title="Change header background color"
                    >
                </div>
                <div class="color-picker-item">
                    <label>Dashboard</label>
                    <input 
                        type="color" 
                        [(ngModel)]="dashboardBackgroundColor" 
                        (ngModelChange)="onDashboardColorChange($event)"
                        class="dashboard-color-picker"
                        title="Change dashboard background color"
                    >
                </div>
            </div>
        </div>

        <div class="client-logo d-flex justify-center">
            <img 
            src="https://www.advanceyourart.com/wp-content/uploads/2019/06/Forbes-Black-Logo-PNG-03003-2-e1517347676630.png"
            alt="Client Logo"
            >
        </div>
    </div>

    <div class="embeds d-flex justify-center align-center">
        <div class="loom-wrapper">
            <div style="position: relative; padding-bottom: 64.98194945848375%; height: 0;">
                <iframe src="https://www.loom.com/embed/b709e8b81a4447649185e9de6be293d0?sid=9f24bce8-538b-49ec-8a5f-efa33822b5ff" frameborder="0" webkitallowfullscreen mozallowfullscreen allowfullscreen style="position: absolute; top: 0; left: 0; width: 100%; height: 100%;"></iframe>
            </div>
        </div>

        <div class="gpt-analysis">
            
            <section>
                <h2>ðŸ“ˆ Campaign Trends & Correlations</h2>
                <ol>
                  <li><strong>Spend vs ROAS:</strong>
                    <ul>
                      <li>Campaigns with lower spend (e.g., Campaigns 1â€“5) typically have <strong>higher ROAS (2.45â€“2.12)</strong>.</li>
                      <li>Heavier spenders (Campaigns 10â€“18) show diminishing returns with <strong>ROAS dropping below 1.5</strong>.</li>
                      <li><strong>Negative correlation between spend and ROAS</strong>, suggesting scaling should be strategic and creative-specific.</li>
                    </ul>
                  </li>
                  <li><strong>CTR vs ROAS</strong> (from graphs):
                    <ul>
                      <li>Days with <strong>higher CTR (e.g., 3.62%)</strong> correlate with <strong>lower CPC (â‚¬0.20)</strong> and competitive ROAS (~2.03).</li>
                      <li><strong>CTR decline over time (from 3.62% â†’ 2.26%)</strong> correlates with <strong>higher CPC</strong> and a slight <strong>drop in ROAS</strong>.</li>
                    </ul>
                  </li>
                  <li><strong>Add to Cart vs Purchases:</strong>
                    <ul>
                      <li>There's a consistent drop-off from "Add to Cart" to "Purchases".</li>
                      <li>For example, 1,678 ATCs result in only 234 purchasesâ€”<strong>a 13.9% conversion rate</strong> from ATC to purchase.</li>
                      <li>Indicates room for optimization in the <strong>checkout funnel</strong>.</li>
                    </ul>
                  </li>
                </ol>
              </section>
            
            <section>
            <h2>ðŸ§  Insights & Takeaways</h2>
            <ul>
                <li><strong>Creative performance matters more than spend</strong>. The highest ROAS (3.82) came from the ad with the lowest spend (â‚¬156.34).</li>
                <li><strong>Campaigns beyond â‚¬3k+ spend tend to see weaker ROAS</strong>, potentially due to broader targeting or fatigued creative.</li>
                <li><strong>CTR and CPC are strong predictors of ROAS.</strong> Higher engagement leads to cheaper clicks and more efficient returns.</li>
                <li><strong>High volume of add-to-carts with relatively low purchases suggests friction in the conversion funnel.</strong></li>
            </ul>
            </section>
        </div>
        
        
    </div>

    <div class="update-section" style="margin-bottom: 20px;">
        <!-- <button class="green" (click)="updateReportStats()">Update Report</button> -->

        <!-- <select class="date-preset-select" [(ngModel)]="selectedDatePreset">
            <option *ngFor="let preset of datePresets" [value]="preset.value">
                {{preset.text}}
            </option>
        </select> -->
    </div>

    <div *ngIf="reportStatsLoading" class="loading">
        Loading...
    </div>

    <div *ngIf="!reportStatsLoading">
        <div class="kpi-section mt-5">
            <div class="section-header d-flex">
                <h2 class="section-title">Main KPIs</h2>
                <div class="dropdown-container ml-4" #kpiDropdownContainer>
                    <button class="dropdown-toggle" (click)="toggleKpiDropdown()">
                        <span>Edit KPIs Overview</span>
                        <span class="dropdown-arrow" [class.open]="isKpiDropdownOpen">â–¼</span>
                    </button>
                    <div class="dropdown-menu" [class.show]="isKpiDropdownOpen" cdkDropList (cdkDropListDropped)="onKpiDrop($event)">
                        <div class="dropdown-item" 
                             *ngFor="let kpi of kpiItems"
                             cdkDrag
                             [cdkDragData]="kpi">
                            <div class="drag-handle" cdkDragHandle>â‹®â‹®</div>
                            <input 
                                type="checkbox" 
                                [checked]="kpi.isVisible"
                                (change)="toggleKpiVisibility(kpi.id)"
                                class="ml-2">
                            <label 
                                class="ml-3"
                                (click)="toggleKpiVisibility(kpi.id)">
                                {{kpi.label}}
                            </label>
                        </div>
                    </div>
                </div>
            </div>
            <div class="kpi-grid">
                <div class="kpi-card" 
                     *ngFor="let kpi of kpiItems" 
                     [style.display]="kpi.isVisible ? 'block' : 'none'">
                    <div class="kpi-label">{{kpi.label}}</div>
                    <div class="kpi-value" [ngClass]="kpi.valueClass">{{kpi.getValue(KPIs)}}</div>
                </div>
            </div>
        </div>

        <div class="graph-section">
            <div class="graph-header d-flex">
                <h2 class="section-title">Performance Trends</h2>
                <div class="dropdown-container ml-4" #dropdownContainer>
                    <button class="dropdown-toggle" (click)="toggleDropdown()">
                        <!-- ({{getVisibleGraphsCount()}}/{{utilGtmlGraphs.length}}) -->
                        <span>Edit Graphs Overview </span>
                        <span class="dropdown-arrow" [class.open]="isDropdownOpen">â–¼</span>
                    </button>
                    <div class="dropdown-menu" [class.show]="isDropdownOpen" cdkDropList (cdkDropListDropped)="onGraphDrop($event)">
                        <div class="dropdown-item" 
                             *ngFor="let graph of utilGtmlGraphs"
                             cdkDrag
                             [cdkDragData]="graph">
                            <div class="drag-handle" cdkDragHandle>â‹®â‹®</div>
                            <input 
                                type="checkbox" 
                                [checked]="graph.isVisible"
                                (change)="toggleGraphVisibility(graph.id)"
                                class="ml-2">
                            <label 
                            class="ml-3"
                            (click)="toggleGraphVisibility(graph.id)"
                            >
                            
                                
                                {{graph.title}}
                            </label>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- <div class="graph-controls">
                
            </div> -->
            <div class="graph-grid">
                <div class="graph-card" 
                     *ngFor="let graph of utilGtmlGraphs" 
                     [style.display]="graph.isVisible ? 'block' : 'none'">
                    <canvas [id]="graph.id"></canvas>
                </div>
            </div>
        </div>

        <div class="ads-section">
            <h2 class="section-title">Top 10 Best Performing Ads</h2>
            <div class="ad-grid">
                <div class="ad-card" *ngFor="let ad of bestAds">
                    <div class="ad-image-container">
                        <!-- [src]="ad.thumbnailUrl" -->
                        <img  class="ad-media" src="https://www.creativefabrica.com/wp-content/uploads/2021/06/28/Image-photo-icon-Graphics-13989898-1-1-580x386.jpg" [alt]="ad.adCreativeId">
                    </div>
                    <div class="metrics">
                        <div class="metric">
                            <div class="metric-label">Spend</div>
                            <div class="metric-value">${{ad.spend | number:'1.2-2'}}</div>
                        </div>
                        <div class="metric">
                            <div class="metric-label">Add to Cart</div>
                            <div class="metric-value">{{ad.addToCart}}</div>
                        </div>
                        <div class="metric">
                            <div class="metric-label">Purchases</div>
                            <div class="metric-value">{{ad.purchases}}</div>
                        </div>
                        <div class="metric">
                            <div class="metric-label">ROAS</div>
                            <div class="metric-value success">{{ad.roas | number:'1.2-2'}}x</div>
                        </div>
                    </div>
                    <!-- [href]="ad.sourceUrl" -->
                    <a  target="_blank" class="view-ad-btn">View Ad</a>
                </div>
            </div>
        </div>

        <div class="campaigns-section">
            <h2 class="section-title">Campaigns Overview</h2>
            <div class="table-container">
                <table class="campaign-table">
                    <thead>
                        <tr>
                            <th>#</th>
                            <th>Campaign Name</th>
                            <th>Spend</th>
                            <th>Purchases</th>
                            <th>Conversion Rate</th>
                            <th>ROAS</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr *ngFor="let campaign of campaigns; let i = index">
                            <td>{{i + 1}}</td>
                            <td>{{campaign.campaignName}}</td>
                            <td>${{campaign.spend}}</td>
                            <td>{{campaign.purchases}}</td>
                            <td>{{campaign.conversionRate}}%</td>
                            <td>{{campaign.purchaseRoas}}x</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
        
    </div>
</div>
