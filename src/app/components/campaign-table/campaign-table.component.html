<h1>Best campaigns</h1>

<div #adAccountsContainer>
@for (adAccount of adAccounts(); track adAccount.id) {
  @if (adAccount.enabled) {
    <div class="ad-account-item" [attr.data-adaccount-id]="adAccount.id">
      <div class="ad-account-header mb-2 mt-4 d-flex justify-between align-center">
        <h4 class="">{{ adAccount.name }}</h4>
        <div class="d-flex align-center">
          @if (!isViewMode()) {
            <label class="mr-2">Show:</label>
            <select class="select-default mr-3"
                    [ngModel]="getCampaignsLimit(adAccount)"
                    (ngModelChange)="onCampaignsLimitChange(adAccount.id, $event)">
              <option [value]="5">5</option>
              <option [value]="10">10</option>
              <option [value]="15">15</option>
              <option [value]="25">25</option>
            </select>

            <label class="mr-2">Best campaigns by:</label>
            <select class="select-default mr-3"
                    [ngModel]="getCampaignsSortMetric(adAccount)"
                    (ngModelChange)="onCampaignsSortMetricChange(adAccount.id, $event)">
              @for (opt of getCampaignSortOptions(adAccount); track opt.value) {
                <option [value]="opt.value">{{ opt.label }}</option>
              }
            </select>
          }

          @if (!isViewMode() && adAccounts().length > 1) {
            <metrics-actions-menu
              [adAccounts]="adAccounts()"
              [sourceAdAccountId]="'' + adAccount.id"
              (adAccountsChange)="adAccounts.set($event)">
            </metrics-actions-menu>
          }
        </div>
      </div>

  <div class="table-container">
    <table class="campaign-table">
      <thead>
        <tr #campaignsHeaderContainer [attr.data-ad-account-id]="adAccount.id">
          <th class="non-sortable">#</th>
          <th class="non-sortable">Campaign</th>
          <ng-container *ngFor="let metric of adAccount.metrics">
            @if (metric.enabled) {
              <th
              [style.cursor]="isViewMode() ? 'auto' : 'grab'"
              class="draggable-metric-header" [attr.data-metric-name]="metric.name">
                {{metricsService.getFormattedMetricName(metric.name)}}
              </th>
            }
          </ng-container>
        </tr>
      </thead>
      <tbody>
          @for (campaign of adAccount.campaignsData ?? []; track campaign.index; let k = $index) {
            <tr>
              <td>{{ k + 1 }}</td>
              <td>{{ campaign.campaign_name }}</td>
              @for (metric of adAccount.metrics; track metric.name) {
                @if (metric.enabled) {
                  <td>
                    {{ getCampaignMetricValue(campaign, metric.name) }}
                  </td>
                }
              }
            </tr>
          }
      </tbody>
    </table>
  </div>
    </div>
  }

}
</div>
