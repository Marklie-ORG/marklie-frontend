<!-- <app-dashboard-header></app-dashboard-header> -->

<div class="container">

    <div 
    class="p-4  mt-4"
    >

        <div>
            <h3 class="mt-2">Change Email</h3>
            <div class="d-flex gap-4 mt-3">
                <div class="d-flex flex-column gap-2" style="width: 280px;">
                    <label for="email">New Email</label>
                    <input id="email" type="text" class="text" [(ngModel)]="email">
                </div>
                <div class="d-flex flex-column gap-2">
                    <label for="changeEmailPassword">Current Password</label>
                    <div class="password-wrapper">
                        <input id="changeEmailPassword" [type]="showChangeEmailPassword ? 'text' : 'password'" class="text" [(ngModel)]="changeEmailPassword" placeholder="•••••••••••">
                        <span class="toggle-password" (click)="showChangeEmailPassword = !showChangeEmailPassword">
                            <fa-icon [icon]="showChangeEmailPassword ? faEyeSlash : faEye"></fa-icon>
                        </span>
                    </div>
                </div>
            </div>
            
            <button (click)="changeEmail()" class="mt-3">Change Email</button>
        </div>

        <hr class="mt-4 mb-4">

        <div>
            <h3>Change Password</h3>
            <div class="d-flex gap-4 mt-3">
                <div class="d-flex flex-column gap-2">  
                    <label for="currentPassword">Current Password</label>
                    <div class="password-wrapper">
                        <input id="currentPassword" [type]="showCurrentPassword ? 'text' : 'password'" class="text" [(ngModel)]="changePasswordPassword" placeholder="•••••••••••">
                        <span class="toggle-password" (click)="showCurrentPassword = !showCurrentPassword">
                            <fa-icon [icon]="showCurrentPassword ? faEyeSlash : faEye"></fa-icon>
                        </span>
                    </div>
                </div>
                
            </div>
            <div class="d-flex gap-4 mt-3">
                <div class="d-flex flex-column gap-2">
                    <label for="newPassword">New Password</label>
                    <div class="password-wrapper">
                        <input id="newPassword" [type]="showNewPassword ? 'text' : 'password'" class="text" [(ngModel)]="newPassword" placeholder="•••••••••••">
                        <span class="toggle-password" (click)="showNewPassword = !showNewPassword">
                            <fa-icon [icon]="showNewPassword ? faEyeSlash : faEye"></fa-icon>
                        </span>
                    </div>
                </div>
                <div class="d-flex flex-column gap-2">
                    <label for="confirmNewPassword">Confirm New Password</label>
                    <div class="password-wrapper">
                        <input id="confirmNewPassword" [type]="showConfirmNewPassword ? 'text' : 'password'" class="text" [(ngModel)]="newPasswordRepeated" placeholder="•••••••••••">
                        <span class="toggle-password" (click)="showConfirmNewPassword = !showConfirmNewPassword">
                            <fa-icon [icon]="showConfirmNewPassword ? faEyeSlash : faEye"></fa-icon>
                        </span>
                    </div>
                </div>
            </div>
            
            <button (click)="changePassword()" class="mt-3">Change Password</button>
        </div>

        <hr class="mt-4 mb-4">

        @if (isOwner) {
            <div>
                <h3>Organization Invite Codes</h3>
                <div class="d-flex gap-3 mt-3 align-items-center">
                    <button (click)="generateInviteCode()" [disabled]="generatingInviteCode">
                        {{ generatingInviteCode ? 'Generating...' : 'Generate New Invite Code' }}
                    </button>
                    @if (latestGeneratedCode) {
                        <div>
                            <strong>Latest code:</strong> <code>{{ latestGeneratedCode }}</code>
                        </div>
                    }
                </div>

                <div class="mt-3">
                    <h4>Previously generated codes</h4>
                    @if (loadingInviteCodes) {
                        <div>Loading...</div>
                    } @else if (!loadingInviteCodes && inviteCodes.length === 0) {
                        <div>No invite codes generated yet.</div>
                    } @else {
                        <div class="d-flex flex-column gap-2">
                            @for (invite of inviteCodes; track invite.uuid) {
                                <div class="d-flex justify-content-between align-items-center p-2" style="border: 1px solid var(--border-color); border-radius: 6px;">
                                    <div class="d-flex flex-column">
                                        <div>
                                            <strong>Code:</strong> <code>{{ invite.code }}</code>
                                        </div>
                                        <div>
                                            <strong>Expires:</strong> {{ invite.expiresAt | date: 'medium' }}
                                        </div>
                                    </div>
                                    <div>
                                        <span [ngClass]="{'text-success': getInviteStatus(invite) === 'Active', 'text-danger': getInviteStatus(invite) !== 'Active'}">{{ getInviteStatus(invite) }}</span>
                                    </div>
                                </div>
                            }
                        </div>
                    }
                </div>
            </div>
        }

        @if (isAdmin) {
            <hr class="mt-4 mb-4">
            <div>
                <h3>Admin: Impersonate User</h3>
                <div class="d-flex gap-4 mt-3">
                    <div class="d-flex flex-column gap-2" style="width: 280px;">
                        <label for="impersonateEmail">User Email</label>
                        <input id="impersonateEmail" type="text" class="text" [(ngModel)]="impersonateEmail" placeholder="user@example.com">
                    </div>
                </div>
                <button (click)="impersonate()" class="mt-3">Impersonate</button>
            </div>
        }
 
    </div>
</div>