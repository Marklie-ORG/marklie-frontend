<div class="container">
  <div class="block" style="height: 100%;">
    <div class="title d-flex align-center justify-between pl-4 pt-4 pr-4 pb-3">
      <h3>Client access requests</h3>
    </div>
  
    @if (isLoading()) {
      <p class="state-text pl-4 pr-4 pb-4">Loading requests…</p>
    } @else if (error()) {
      <p class="state-text error pl-4 pr-4 pb-4">{{ error() }}</p>
    } @else if (canShowTable()) {
      <div class="table">
        <div class="header d-flex align-center pb-3 pl-4 pr-4">
          <div [style.width]="columnWidths.email">Email</div>
          <div [style.width]="columnWidths.client">Client</div>
          <div [style.width]="columnWidths.status" class="d-flex align-center">Status</div>
          <div [style.width]="columnWidths.requested">Requested</div>
          <div [style.width]="columnWidths.actions" class="d-flex align-center justify-center">Actions</div>
        </div>
  
        <div class="list">
          @for (request of requests(); track request.uuid) {
            <div class="row d-flex align-center pt-3 pb-3 pl-4 pr-4">
              <div [style.width]="columnWidths.email">{{ request.email }}</div>
              <div [style.width]="columnWidths.client">{{ request.organizationClient?.name || '—' }}</div>
              <div [style.width]="columnWidths.status">
                <span class="status" [class.status--granted]="request.isGranted">
                  {{ request.isGranted ? 'Access granted' : 'Pending' }}
                </span>
              </div>
              <div [style.width]="columnWidths.requested">{{ formatDate(request.createdAt) }}</div>
              <div [style.width]="columnWidths.actions" class="d-flex align-center justify-center">
                @if (!request.isGranted) {
                  <button
                    class="blue"
                    type="button"
                    (click)="shareAccess(request)"
                    [disabled]="isActionDisabled(request)"
                  >
                    {{ isSharingRequest(request) ? 'Sharing…' : 'Share access' }}
                  </button>
                }
              </div>
            </div>
          }
        </div>
      </div>
    } @else if (showEmptyState()) {
      <p class="state-text pl-4 pr-4 pb-4">No access requests yet.</p>
    }
  </div>
</div>

