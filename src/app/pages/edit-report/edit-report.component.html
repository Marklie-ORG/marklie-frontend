<div class="dashboard">
    <div class="update-section" style="margin-bottom: 20px;">
        <!-- <button class="green" (click)="updateReportStats()">Update Report</button>

        <select class="date-preset-select ml-4" [(ngModel)]="selectedDatePreset">
            <option *ngFor="let preset of datePresets" [value]="preset.value">
                {{preset.text}}
            </option>
        </select> -->
    </div>

    <div *ngIf="reportStatsLoading" class="loading">
        Loading...
    </div>

    <div *ngIf="!reportStatsLoading">
        <div class="kpi-section">
            <h2 class="section-title">Main KPIs</h2>
            <div class="kpi-grid">
                <div class="kpi-card">
                    <div class="kpi-label">Total Spend</div>
                    <div class="kpi-value primary">${{KPIs?.spend | number:'1.2-2'}}</div>
                </div>
                <div class="kpi-card">
                    <div class="kpi-label">ROAS</div>
                    <div class="kpi-value success">{{KPIs?.purchaseRoas | number:'1.2-2'}}x</div>
                </div>
                <div class="kpi-card">
                    <div class="kpi-label">Conversion Value</div>
                    <div class="kpi-value success">${{KPIs?.conversionValue | number:'1.2-2'}}</div>
                </div>
                <div class="kpi-card">
                    <div class="kpi-label">Purchases</div>
                    <div class="kpi-value success">{{KPIs?.purchases}}</div>
                </div>
                <div class="kpi-card">
                    <div class="kpi-label">Impressions</div>
                    <div class="kpi-value">{{KPIs?.impressions | number:'1.0-0'}}</div>
                </div>
                <div class="kpi-card">
                    <div class="kpi-label">Clicks</div>
                    <div class="kpi-value">{{KPIs?.clicks | number:'1.0-0'}}</div>
                </div>
                <div class="kpi-card">
                    <div class="kpi-label">CPC</div>
                    <div class="kpi-value">${{KPIs?.cpc | number:'1.2-2'}}</div>
                </div>
                <div class="kpi-card">
                    <div class="kpi-label">CTR</div>
                    <div class="kpi-value">{{KPIs?.ctr | number:'1.2-2'}}%</div>
                </div>
                <div class="kpi-card">
                    <div class="kpi-label">Cost Per Purchase</div>
                    <div class="kpi-value">${{KPIs?.costPerPurchase | number:'1.2-2'}}</div>
                </div>
                
                <div class="kpi-card">
                    <div class="kpi-label">Add To Cart</div>
                    <div class="kpi-value">{{KPIs?.addToCart | number:'1.0-0'}}</div>
                </div>
                <div class="kpi-card">
                    <div class="kpi-label">Cost Per Add To Cart</div>
                    <div class="kpi-value">${{KPIs?.costPerAddToCart | number:'1.2-2'}}</div>
                </div>
                <div class="kpi-card">
                    <div class="kpi-label">Initiated Checkouts</div>
                    <div class="kpi-value">{{KPIs?.initiatedCheckouts | number:'1.0-0'}}</div>
                </div>
                
            </div>
        </div>

        <div class="graph-section">
            <h2 class="section-title">Performance Trends</h2>
            <div class="graph-controls">
                <div class="dropdown-container" #dropdownContainer>
                    <button class="dropdown-toggle" (click)="toggleDropdown()">
                        <span>Edit Graphs Overview ({{getVisibleGraphsCount()}}/{{utilGtmlGraphs.length}})</span>
                        <span class="dropdown-arrow" [class.open]="isDropdownOpen">▼</span>
                    </button>
                    <div class="dropdown-menu" [class.show]="isDropdownOpen" cdkDropList (cdkDropListDropped)="onGraphDrop($event)">
                        <div class="dropdown-item" 
                             *ngFor="let graph of utilGtmlGraphs"
                             cdkDrag
                             [cdkDragData]="graph">
                            <div class="drag-handle" cdkDragHandle>⋮⋮</div>
                            <input 
                                type="checkbox" 
                                [checked]="graph.isVisible"
                                (change)="toggleGraphVisibility(graph.id)"
                                class="ml-2">
                            <label 
                            class="ml-3"
                            (click)="toggleGraphVisibility(graph.id)"
                            >
                            
                                
                                {{graph.title}}
                            </label>
                        </div>
                    </div>
                </div>
            </div>
            <div class="graph-grid">
                <div class="graph-card" 
                     *ngFor="let graph of utilGtmlGraphs" 
                     [style.display]="graph.isVisible ? 'block' : 'none'">
                    <canvas [id]="graph.id"></canvas>
                </div>
            </div>
        </div>

        <div class="ads-section">
            <h2 class="section-title">Top 10 Best Performing Ads</h2>
            <div class="ad-grid">
                <div class="ad-card" *ngFor="let ad of bestAds">
                    <div class="ad-image-container">
                        <!-- [src]="ad.thumbnailUrl" -->
                        <img  class="ad-media" src="https://www.creativefabrica.com/wp-content/uploads/2021/06/28/Image-photo-icon-Graphics-13989898-1-1-580x386.jpg" [alt]="ad.adCreativeId">
                    </div>
                    <div class="metrics">
                        <div class="metric">
                            <div class="metric-label">Spend</div>
                            <div class="metric-value">${{ad.spend | number:'1.2-2'}}</div>
                        </div>
                        <div class="metric">
                            <div class="metric-label">Add to Cart</div>
                            <div class="metric-value">{{ad.addToCart}}</div>
                        </div>
                        <div class="metric">
                            <div class="metric-label">Purchases</div>
                            <div class="metric-value">{{ad.purchases}}</div>
                        </div>
                        <div class="metric">
                            <div class="metric-label">ROAS</div>
                            <div class="metric-value success">{{ad.roas | number:'1.2-2'}}x</div>
                        </div>
                    </div>
                    <!-- [href]="ad.sourceUrl" -->
                    <a  target="_blank" class="view-ad-btn">View Ad</a>
                </div>
            </div>
        </div>

        <div class="campaigns-section">
            <h2 class="section-title">Campaigns Overview</h2>
            <div class="table-container">
                <table class="campaign-table">
                    <thead>
                        <tr>
                            <th>#</th>
                            <th>Campaign Name</th>
                            <th>Spend</th>
                            <th>Purchases</th>
                            <th>Conversion Rate</th>
                            <th>ROAS</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr *ngFor="let campaign of campaigns; let i = index">
                            <td>{{i + 1}}</td>
                            <td>{{campaign.campaignName}}</td>
                            <td>${{campaign.spend}}</td>
                            <td>{{campaign.purchases}}</td>
                            <td>{{campaign.conversionRate}}%</td>
                            <td>{{campaign.purchaseRoas}}x</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
        
    </div>
</div>
